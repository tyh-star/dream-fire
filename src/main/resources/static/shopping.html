<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Site</title>
    <style>
        /* General styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px 20px;
            background-color: #333;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .search-bar {
            display: flex;
            align-items: center;
            background-color: #fff;
            padding: 5px 10px;
            border-radius: 30px;
            width: 500px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        #search-input {
            border: none;
            outline: none;
            width: 100%;
            padding: 5px;
            font-size: 16px;
            color: #333;
        }

        .search-icon {
            margin-left: 10px;
            font-size: 20px;
            color: #333;
            cursor: pointer;
        }

        .user-actions {
            position: absolute;
            right: 20px;
            display: flex;
            align-items: center;
        }

        .user-icon, .seller-icon {
            font-size: 24px;
            cursor: pointer;
            color: white;
            margin-left: 20px;
        }

        .user-icon:hover, .seller-icon:hover {
            color: #ddd;
        }

        /* Main content wrapper */
        .content-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin: 20px;
            gap: 20px;
        }

        /* Category menu styles */
        .category-menu {
            flex: 0 0 250px; /* å›ºå®šå®½åº¦ */
            background-color: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            margin-top: 20px;
            height: calc(100vh - 80px); /* é«˜åº¦ä¸è§†å£ä¸€è‡´ */
             /* å¦‚æœå†…å®¹è¶…å‡ºï¼Œåˆ™å…è®¸æ»šåŠ¨ */
        }

        .category-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .category-list li {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .category-list li:hover {
            background-color: #f9f9f9;
        }

        .icon {
            font-size: 20px;
            margin-right: 10px;
            color: #555;
        }

        /* Product grid styles */
        .random-products {
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: auto;
            max-height: calc(100vh - 90px); /* ç¡®ä¿é«˜åº¦ä¸è¶…å‡ºè§†å£ */
        }

        .product-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
            background-color: #f9f9f9;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .product-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .product-name {
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        .product-price {
            font-size: 18px;
            color: #e60023;
            margin: 0 10px 10px;
            font-weight: bold;
        }

        /* Loading message styles */
        .loading-message {
            text-align: center;
            font-size: 18px;
            color: #666;
            margin: 20px 0;
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<!-- Navbar -->
<div class="navbar">
    <div class="search-bar">
        <input type="text" id="search-input" placeholder="Search for products...">
        <i class="fas fa-search search-icon" onclick="searchProducts()"></i>
    </div>
    <div class="user-actions">
        <i class="fas fa-user-circle user-icon" onclick="viewProfile()"></i>
        <i class="fas fa-store seller-icon" onclick="viewSellerPage()"></i>
    </div>
</div>

<!-- Main content wrapper -->
<div class="content-wrapper">
    <!-- Category Menu -->
    <div class="category-menu">
        <ul class="category-list">
            <li data-query="Home Appliances" onclick="handleSearch('Home Appliances')">
                <span class="icon">ğŸ“º</span> Home Appliances
            </li>
            <li data-query="Phones" onclick="handleSearch('Phones')">
                <span class="icon">ğŸ“±</span> Phones / Operators / Digital
            </li>
            <li data-query="Computers" onclick="handleSearch('Computers')">
                <span class="icon">ğŸ’»</span> Computers / Office / Stationery
            </li>
            <li data-query="Furniture" onclick="handleSearch('Furniture')">
                <span class="icon">ğŸ›‹ï¸</span> Furniture / Home Decor / Kitchenware
            </li>
            <li data-query="Clothing" onclick="handleSearch('Clothing')">
                <span class="icon">ğŸ‘•</span> Menâ€™s / Womenâ€™s / Kidsâ€™ Clothing
            </li>
            <li data-query="Beauty" onclick="handleSearch('Beauty')">
                <span class="icon">ğŸ§´</span> Beauty / Personal Care / Pets
            </li>
            <li data-query="Womens" onclick="handleSearch('Womens')">
                <span class="icon">ğŸ‘ </span> Womenâ€™s Shoes / Bags / Watches / Jewelry
            </li>
            <li data-query="Mens" onclick="handleSearch('Mens')">
                <span class="icon">ğŸ‘Ÿ</span> Menâ€™s Shoes / Sports / Outdoors
            </li>
            <li data-query="Real Estate" onclick="handleSearch('Real Estate')">
                <span class="icon">ğŸ </span> Real Estate / Cars / Automotive Supplies
            </li>
            <li data-query="Mother & Baby" onclick="handleSearch('Mother & Baby')">
                <span class="icon">ğŸ¼</span> Mother & Baby / Toys / Instruments
            </li>
            <li data-query="Food" onclick="handleSearch('Food')">
                <span class="icon">ğŸ</span> Food / Alcohol / Fresh / Specialty
            </li>
        </ul>

    </div>

    <!-- Random Products -->
    <div class="random-products" id="random-products"></div>
</div>

<!-- Loading Message -->
<div class="loading-message" id="loading-message">Loading...</div>
</body>
</html>

<script>
    // åŸæ¥çš„éšæœºå•†å“å±•ç¤ºåŠŸèƒ½
    async function displayRandomProducts() {
        try {
            const response = await fetch('/product/random');
            const data = await response.json();
            const products = data.list || [];
            const productContainer = document.getElementById('random-products');
            productContainer.innerHTML = '';

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';

                const imageUrl = product.mainImageUrl
                    ? `http://35.183.41.31:8080${product.mainImageUrl}`
                    : "http://35.183.41.31:8080/images/default-image.png";

                productCard.innerHTML = `
                    <img class="product-image" src="${imageUrl}" alt="${product.productName || 'Unknown Product'}" onerror="this.src='http://35.183.41.31:8080/images/default-image.png';">
                    <div class="product-name">${product.productName || "Unknown"}</div>
                    <div class="product-price">Â¥${product.price || "0.00"}</div>
                `;
                productCard.addEventListener('click', () => {
                    const productData = encodeURIComponent(JSON.stringify(product));
                    window.location.href = `productDetail.html?productData=${productData}`;
                });
                productContainer.appendChild(productCard);
            });
        } catch (error) {
            console.error("Error fetching random products:", error);
        }
    }

    // æ–°å¢ï¼šä¸‹æ»‘åŠ è½½æ›´å¤šå•†å“
    let currentPage = 1; // å½“å‰é¡µç 
    let isLoadingMore = false; // æ˜¯å¦æ­£åœ¨åŠ è½½ä¸­

    async function loadMoreProducts() {
        // é˜²æ­¢é‡å¤åŠ è½½
        if (isLoadingMore) return;

        isLoadingMore = true;
        const loadingMessage = document.getElementById('loading-message');
        loadingMessage.style.display = 'block'; // æ˜¾ç¤ºåŠ è½½æç¤º

        try {
            // è·å–å½“å‰é¡µçš„æ•°æ®
            const response = await fetch(`/product/random?page=${currentPage}`);
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            const products = data.list || [];
            const productContainer = document.getElementById('random-products');

            if (products.length > 0) {
                products.forEach(product => {
                    // åˆ›å»ºå•†å“å¡ç‰‡
                    const productCard = document.createElement('div');
                    productCard.className = 'product-card';

                    // åŠ¨æ€ç”Ÿæˆå›¾ç‰‡ URL
                    const imageUrl = product.mainImageUrl
                        ? `http://35.183.41.31:8080${product.mainImageUrl}`
                        : "http://35.183.41.31:8080/images/default-image.png";

                    // å•†å“å¡ç‰‡å†…å®¹
                    productCard.innerHTML = `
                    <img class="product-image" src="${imageUrl}" alt="${product.productName || 'Unknown Product'}"
                         onerror="this.src='http://localhost:8080/images/default-image.png';">
                    <div class="product-name">${product.productName || "Unknown"}</div>
                    <div class="product-price">Â¥${product.price || "0.00"}</div>
                `;

                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œè·³è½¬åˆ°è¯¦æƒ…é¡µ
                    productCard.addEventListener('click', () => {
                        const productData = encodeURIComponent(JSON.stringify(product));
                        window.location.href = `productDetail.html?productData=${productData}`;
                    });

                    // æ·»åŠ å•†å“å¡ç‰‡åˆ°å®¹å™¨
                    productContainer.appendChild(productCard);
                });

                // å¢åŠ é¡µç 
                currentPage++;
            } else {
                // å¦‚æœæ²¡æœ‰æ›´å¤šå•†å“
                loadingMessage.innerText = 'æ²¡æœ‰æ›´å¤šå•†å“äº†';
            }
        } catch (error) {
            console.error("Error loading more products:", error);
            loadingMessage.innerText = 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
        } finally {
            isLoadingMore = false;
            loadingMessage.style.display = 'none'; // éšè—åŠ è½½æç¤º
        }
    }


    // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºç¬¬ä¸€é¡µ
    document.addEventListener('DOMContentLoaded', () => {
        displayRandomProducts();
    });

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    window.addEventListener('scroll', () => {
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;

        if (!isLoadingMore && scrollTop + clientHeight >= scrollHeight - 10) {
            loadMoreProducts();
        }
    });

    // æœç´¢åŠŸèƒ½
    async function searchProducts() {
        const query = document.getElementById("search-input").value.trim();
        if (!query) {
            alert("Please enter a search term.");
            return;
        }
        window.location.href = `productShow.html?query=${encodeURIComponent(query)}`;
    }
    // å¤„ç†æœç´¢çš„å‡½æ•°
    function handleSearch(query) {
        if (!query) {
            alert("Invalid category or search term.");
            return;
        }
        // è·³è½¬åˆ°ç›®æ ‡é¡µé¢å¹¶ä¼ é€’æœç´¢å‚æ•°
        window.location.href = `productShow.html?query=${encodeURIComponent(query)}`;
    }


    // ç”¨æˆ·ä¿¡æ¯è·³è½¬
    function viewProfile() {
        window.location.href = 'userInformation.html';
    }

    function viewSellerPage() {
        window.location.href = 'seller.html';
    }
</script>

</body>
</html>






